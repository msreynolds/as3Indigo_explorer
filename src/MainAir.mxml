<?xml version="1.0" encoding="utf-8"?>
<s:WindowedApplication xmlns:fx="http://ns.adobe.com/mxml/2009"
                       xmlns:s="library://ns.adobe.com/flex/spark"
                       xmlns:mx="library://ns.adobe.com/flex/mx"
                       xmlns:model="com.perceptiveautomation.indigo.model.*"
                       xmlns:services="com.perceptiveautomation.indigo.services.*"
                       xmlns:shiny="library://ns.shinynet.com/flex/shinylib"
                       width="1280"
                       height="1024"
                       title="AS3Indigo Explorer v1.0"
                       creationComplete="creationComplete()"
        >

    <fx:Script><![CDATA[
        import com.perceptiveautomation.indigo.model.IndigoModel;
        import com.perceptiveautomation.indigo.vo.IndigoLoginData;

        import spark.events.ListEvent;

        [Bindable]
        protected var indigoModel:IndigoModel = IndigoModel.getInstance();

        [Bindable]
        protected var indigoLoginData:IndigoLoginData = new IndigoLoginData("localhost");

        protected function creationComplete():void
        {
            listIndigoDevices.addEventListener("showItemDetail", list_doubleClickHandler);
            listIndigoVariables.addEventListener("showItemDetail", list_doubleClickHandler);
            listIndigoActionGroups.addEventListener("showItemDetail", list_doubleClickHandler);
            listIndigoTriggers.addEventListener("showItemDetail", list_doubleClickHandler);
        }

        protected function btnIndigoConnect_clickHandler(event:MouseEvent):void
        {
            indigoService.connect(indigoLoginData);
        }

        protected function list_doubleClickHandler(event:ListEvent):void
        {
            currentState = "Detail";
        }

        private function btnBackToMaster_clickHandler(event:MouseEvent):void
        {
            currentState = "Master";
        }
    ]]></fx:Script>

    <s:layout>
        <s:VerticalLayout horizontalAlign="center" verticalAlign="middle"/>
    </s:layout>

	<fx:Declarations>

        <!-- Place non-visual elements (e.g., services, value objects) here -->
        <services:IndigoService id="indigoService"/>

    </fx:Declarations>

    <s:HGroup horizontalAlign="center" width="100%" paddingTop="25">

        <s:HGroup horizontalAlign="left" width="25%" paddingLeft="25"/>

        <s:HGroup horizontalAlign="center" verticalAlign="baseline" width="50%">
            <!-- Indigo Login Data Fields -->
            <!--<s:Label text="Indigo Server"/> -->
            <s:TextInput id="tiUsername" width="80" prompt="Username" text="{indigoLoginData.username}"/>
            <s:TextInput id="tiPassword" width="80" prompt="Password" text="{indigoLoginData.password}"/>
            <s:TextInput id="tiIndigoServerAddress" width="135" prompt="Indigo Server Address" text="{indigoLoginData.host}"/>
            <s:TextInput id="tiIndigoServerPort" width="48" prompt="Port" text="{indigoLoginData.port}"/>
            <s:Button id="btnIndigoConnect" click="btnIndigoConnect_clickHandler(event)" label="Go!"/>
        </s:HGroup>

        <s:HGroup horizontalAlign="left" width="25%" paddingRight="25"/>

    </s:HGroup>

    <s:Spacer height="14"/>

    <s:HGroup id="hgroupMasterContentGroup"
              name="master"
              horizontalCenter="0"
              width="100%"
              height="100%"
              paddingLeft="25"
              paddingRight="25">

        <s:VGroup width="20%" height="100%">
            <s:Label text="{'Indigo Devices (' + listIndigoDevices.dataProvider.length + ')'}"/>
            <s:List id="listIndigoDevices"
                    dataProvider="{indigoModel.deviceList}"
                    itemRenderer="com.perceptiveautomation.indigo.view.components.renderers.IndigoDeviceListItemRenderer"
                    doubleClickEnabled="true"
                    width="100%"
                    height="100%"
                    />
        </s:VGroup>

        <s:VGroup width="20%" height="100%">
            <s:Label text="{'Indigo Variables (' + listIndigoVariables.dataProvider.length + ')'}"/>
            <s:List id="listIndigoVariables"
                    dataProvider="{indigoModel.variableList}"
                    itemRenderer="com.perceptiveautomation.indigo.view.components.renderers.IndigoVariableListItemRenderer"
                    width="100%"
                    height="100%"
                    />
        </s:VGroup>

        <s:VGroup width="20%" height="100%">
            <s:Label text="{'Indigo Action Groups (' + listIndigoActionGroups.dataProvider.length + ')'}"/>
            <s:List id="listIndigoActionGroups"
                    dataProvider="{indigoModel.actionGroupList}"
                    itemRenderer="com.perceptiveautomation.indigo.view.components.renderers.IndigoActionGroupListItemRenderer"
                    width="100%"
                    height="100%"
                    />
        </s:VGroup>

        <s:VGroup width="20%" height="100%">
            <s:Label text="{'Indigo Schedules (' + listIndigoSchedules.dataProvider.length + ')'}"/>
            <s:List id="listIndigoSchedules"
                    dataProvider="{indigoModel.scheduleList}"
                    itemRenderer="com.perceptiveautomation.indigo.view.components.renderers.IndigoScheduleListItemRenderer"
                    width="100%"
                    height="100%"
                    />
        </s:VGroup>

        <s:VGroup width="20%" height="100%">
            <s:Label text="{'Indigo Triggers (' + listIndigoTriggers.dataProvider.length + ')'}"/>
            <s:List id="listIndigoTriggers"
                    dataProvider="{indigoModel.triggerList}"
                    itemRenderer="com.perceptiveautomation.indigo.view.components.renderers.IndigoTriggerListItemRenderer"
                    width="100%"
                    height="100%"
                    />
        </s:VGroup>

    </s:HGroup>

    <s:Spacer height="14"/>

    <s:HGroup horizontalCenter="0" width="100%" height="300" paddingLeft="25" paddingRight="25" paddingBottom="25">

        <s:VGroup id="panelLog"
                  width="300"
                  height="100%">
            <s:Label text="Indigo Log"/>
            <s:TextArea id="taIndigoLog"
                        editable="false"
                        selectable="true"
                        text="{indigoModel.logStream}"
                        borderVisible="true"
                        verticalScrollPolicy="on"
                        width="100%"
                        height="100%"
                    />

        </s:VGroup>

        <s:VGroup id="panelPackets"
                  width="100%"
                  height="100%">

            <s:Label text="Indigo Packets"/>
            <s:TextArea id="taIndigoPackets"
                        editable="false"
                        selectable="true"
                        text="{indigoModel.packetStream}"
                        borderVisible="true"
                        verticalScrollPolicy="on"
                        width="100%"
                        height="100%"
                        />
        </s:VGroup>

    </s:HGroup>

</s:WindowedApplication>
